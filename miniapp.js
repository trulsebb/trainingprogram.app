"use strict";const i=[{id:0,title:"Basic training program",shareString:"ko04Y_04-3njS_04-3n0M_04-55GOcM_04-212_04-82bhXNF92_^8084448k-2+48484A0c4448s-2+4c448-23Wkk484g"},{id:1,title:"Swiss program",shareString:"ks08Y8084448k-2+48484A0c4448s_-3nqk8084448w-2+48484w0c4448E_08-313e8084448k-2+48484A0c4448s_-560XWQ8084448k-2+48484A0c4448s_08-2128084448k-2+48484A0c4448s_-69b2Ype8084448w-2+48484w0c4448E_0008-3omo8084448k-2+48484A0c4448s_-3osQ8084448k-2+48484w0c4448s_08-3mo88084448w-2+48484w0c4448E_-3omo8084448w-2+48484w0c4448E_00^-2+4c448-23Wkk484g"},{id:2,title:"Oldschool linear",shareString:"oo04Y40_04M40_04-3n0M40_04-3njS40_04-21240_04-31mA40_^c4448E-2+4c448-23Kgk448E-2+4"}],p=["bench","press","benchpress","overhead","squat","squats","deadlift","dead","wide","medium","close","grip","stance","bulgarian","split","sumo","snatch","tricep","bicep","curl","french","paused","highbar","lowbar","Larsen","incline","deficit","weighted","row","sealrow","standing","seated","belt","beltless","floor","log","clean","jerk","and","rack","pull","pullups","dips","block","board","yoke","farmers","atlas","stone","carry","lift","hip","shoulder","lateral","raise","pin","dumbbell","barbell","cable","flyes","chest","back","extension","glute","bride","ham","flexion","wrist","reverse","rotation","lying","retraction","with","without","bands","handstand","narrow","elevated","deltoid","stretch","wall","military","behind","neck","reclined","one","arm","leg","alternating","rope","twisting","machine","smith","neutral","parallel","bent","over","straight","rounded","jefferson","high","low","placement","bar","cheat","extra","between","uni","unilateral","EZ","EZ-bar","hexbar","trapbar","double","single","wraps","wrapped","slingshot","lat","hamstring","supported","seal","pinch","walk","run","sprint","climb","rolling","thunder","thumbless","side","crunch","crunches","situp","JM","JM-press","hook","hookgrip","less","plate","plates","two","handed","ring","push","up","muscle","nordic","semi","SSB","banded","band","bands","resistance","strict","partial","rep","quarter","half","full","ROM","below","above","height","knee","stiff","stiffleg","superset","supersetted","front","viking","conventional","continental","transformer","transformerbar","cambered","camber","goblet","zero","higher","hinge","hold","handles","setting","sandbag","axle","circus","romanian","kettlebell","three","four","five","six","seven","eight","nine","ten","from","on","at","hand","legpress","pulldown"],s=document.getElementsByTagName("template"),l=(n,a)=>{if(n===a)return 0;const r=[];for(let t=0;t<=a.length;t++){r[t]=[t];for(let e=1;e<=n.length;e++)r[t][e]=0===t?e:Math.min(r[t-1][e]+1,r[t][e-1]+1,r[t-1][e-1]+(n[e-1]===a[t-1]?0:1))}return r[a.length][n.length]},o=t=>{const l=[{sub:"",children:[]}];for(let e=0;e<t.length;++e){let a=t.slice(e),r=0,s=0;for(;s<a.length;){var o=a.charAt(s);const c=l[r].children;let t=0,n,e=!1;for(;;)if(t===c.length){n=l.length;const p={sub:"",children:[]};p.sub=a.slice(s),l.push(p),c.push(n),e=!0}else{if(n=c[t],l[n].sub.charAt(0)===o)break;t++}if(!e){const d=l[n].sub;let e=0;for(;e<d.length;){if(a.charAt(s+e)!==d.charAt(e)){var i=n;n=l.length;const m={sub:"",children:[]};m.sub=d.slice(0,e),m.children.push(i),l.push(m),l[i].sub=d.slice(e),l[r].children[t]=n;break}e++}s+=e,r=n}}}const n={};l.map(e=>{!n.hasOwnProperty(e.sub)&&4<e.sub.length&&e.sub.length<t.length/2&&1<t.split(e.sub).length-1&&(n[e.sub]=(t.split(e.sub).length-1)*e.sub.length)});var e=Object.entries(n).sort((e,t)=>t[1]-e[1]);return 0<e.length?e[0][0]:""},_=e=>{var t=o(e);return 3<t.length?e.replaceAll(t,"_")+"^"+t:e},V=e=>{const t=e.split("^");return t.length<2?e:t[0].replaceAll("_",t[1])},q=(t,e)=>e.map(e=>l(t.toLowerCase(),e.toLowerCase())).reduce((e,t,n,a)=>t<a[e]?n:e,0),d=9999,U=(e,t)=>e*(36/(37-t));var z;z=1;const J=n=>t=>e=>U(n,t+(11-e-z)),f=e=>{e=2.5*Math.round(e/2.5);return 0<e?e:""},$="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),F=(e,t=0)=>{if(0==e)return"0".padStart(t,"0");let n="";var a=e<0?"+":"";let r=(4*Math.abs(e)).toFixed();for(;0<r;)n=$[r%62]+n,r=(r-r%62)/62;return(a+n).padStart(t,"0")},X=e=>{var t="+"===e[0];const n="+"===e[0]?e.slice(1):e;e=n.split("").map(t=>$.findIndex(e=>e==t)).reverse().map((e,t)=>e*62**t).reduce((e,t)=>e+t)/4;return t?-1*e:e};class m{static latestId=1e3;static resetId(){this.latestId=1e3}static getUniqueId(){return this.latestId++}}const u=()=>[...Array(localStorage.length).keys()].map(e=>localStorage.key(e)),Y=(e,t)=>F([e,t].join("")),g=()=>u().filter(e=>e.match(/^\d{4}$/g)).map(e=>{localStorage.removeItem(e)}),G=()=>u().filter(e=>e.match(/^\d{4}$/g)).map(e=>Y(e,localStorage.getItem(e))).join("-"),H=e=>{const t=X(e).toString(10);return[t.slice(0,4),t.slice(4)]},K=e=>e.split("-").map(e=>H(e)),h=()=>{var e=(new Date).toISOString().slice(0,10),t=y(d)(0);const n=G();1<n.split("-").length&&localStorage.setItem(`progress-${t}-`+e,G())},c=e=>{h(),g(),K(e).map(e=>b(e[0])(e[1]))},b=t=>e=>localStorage.setItem(t,e),y=t=>e=>localStorage.getItem(t)?localStorage.getItem(t):e,Q=()=>{let t=0;for(;t=Math.floor(900*Math.random()+100),0<u().filter(e=>e.match(new RegExp("^program-"+t,"g"))).length;);return t},Z=(e,t)=>{const n=r().find(e=>e.shareString==t);if("object"==typeof n&&n.hasOwnProperty("id"))return n.id;var a=Q();return localStorage.setItem(`program-${a}-`+e,t),a},r=()=>{return u().filter(e=>e.match(/^program-/g)).map(e=>({id:Number(e.match(/^program-(\d+)/)[1]),title:e.match(/^program-\d+-(.+)/)[1],shareString:localStorage.getItem(e)}))},ee=()=>[...i,...r()],v=t=>ee().find(e=>e.id==t)??v(0),w=(e,t)=>{const n=s[e],a=n.content.firstElementChild.cloneNode(!0);return"string"==typeof t?a.textContent=t:Array.isArray(t)?a.append(...t):"object"==typeof t&&a.appendChild(t),a},x=e=>{e.querySelectorAll(":not(template,style,.clearKeep)").forEach(e=>e.remove())},E=(e,t="block")=>{e.style.display==t?e.style.display="none":e.style.display=t},k=(e,t,n)=>{const a=document.createElement(e);return a.classList.add(...t),"string"==typeof n?a.textContent=n:Array.isArray(n)?a.append(...n):"object"==typeof n&&a.appendChild(n),a},te=(t,n=null)=>{document.addEventListener("mouseup",e=>{t.contains(e.target)||null!==n&&n.contains(e.target)||(t.style.display="none")})},ne=e=>k("tr",[],e.map(e=>k("td",[],e))),ae=e=>{const t=document.createElement("input");return t.id=m.getUniqueId(),t.onchange=()=>b(t.id)(t.checked?1:0),t.setAttribute("type","checkBox"),t.checked="1"===y(t.id)(0),t.setAttribute("aria-label",e),t.setAttribute("title",e),t},S=(e,t,n,a,r)=>{const s=document.createElement("input");return t<100&&1==n&&s.classList.add("smallInput"),s.id=m.getUniqueId(),s.onchange=()=>b(s.id)(s.value),s.setAttribute("type","number"),s.value=y(s.id)(a),s.min=e,s.max=t,s.step=n,s.setAttribute("aria-label",r),s.setAttribute("title",r),s},C=(e,t,n=!1)=>{const a=document.createElement("input");return n&&a.classList.add("alwaysDisabled"),a.setAttribute("type","text"),a.value=e,a.disabled=!0,a.setAttribute("aria-label",t),a.setAttribute("title",t),a};class L{static shareContainer=null;static getShareButton=()=>{const e=k("button",["loadSaveButton"],"ðŸ’¾ Load/save progress");return e.onclick=()=>{this.shareContainer.dispatchEvent(new Event("toggleVisibility")),E(this.shareContainer)},e};static initShareContainer=()=>{const o=k("div",["shareLinkContainer"]);o.style.display="none",o.addEventListener("toggleVisibility",()=>{x(o);var e=y(d)(0);const t=new RegExp("progress-"+e,"g"),n=(o.append(...u().filter(e=>e.match(t)).sort().map(e=>{var t=e.substring(e.length-10);const n=k("div",["shareStringContainer"],k("label",["shareStringLabel"],t)),a=k("button",["clearButton"],"âœ–"),r=(a.onclick=()=>{localStorage.removeItem(e),o.dispatchEvent(new Event("toggleVisibility"))},k("input",["presentedlink"],"")),s=(r.type="text",r.value=localStorage.getItem(e),k("button",[],"Copy")),l=(s.onclick=()=>{r.select(),document.execCommand("copy")},k("button",[],"Restore"));return l.onclick=()=>{c(r.value),W.render()},n.append(a,r,s,l),n})),k("div",["shareStringContainer"])),a=k("button",[],"Save current"),r=(a.onclick=()=>{h(),o.dispatchEvent(new Event("toggleVisibility"))},k("button",["closebutton"],"â–² â–² â–²"));r.onclick=()=>E(o),n.append(a),o.append(n,r)}),this.shareContainer=o}}const re=e=>{const t=k("h2",["restDayText"],"Rest day");return 0<e.length&&(t.style.display="none"),t},I=e=>e.charAt(0).toUpperCase()+e.slice(1),se=e=>e.map(e=>""+String(e).length+e).join(""),le=e=>{let t=0;const n=String(e),a=[];for(;t<n.length;)a.push(n.slice(t+1,t+Number(n[t])+1)),t=t+Number(n[t])+1;return a},B=e=>I(le(e).map(e=>p[e]).join(" "));class M{static programSettingsContainer=document.getElementById("programSettingsContainer");static startDateOption=null;static toggleVisibility=(e=!1)=>{var t=this.programSettingsContainer.getBoundingClientRect();(e||0<=t.top)&&E(this.programSettingsContainer,"flex"),"none"!=this.programSettingsContainer.style.display&&this.programSettingsContainer.scrollIntoView({behavior:"smooth"})};static movementsMaxMap=new Map;static movementsMaxInputMap=new Map;static programSettingsButton=document.getElementById("programSettingsButton");static init(){this.programSettingsButton.onclick=()=>this.toggleVisibility()}static render=(r,e,s)=>{this.programSettingsButton.disabled=!1,x(this.programSettingsContainer),this.movementsMaxInputMap=new Map,this.movementsMaxMap=new Map;const t=[...new Set(r.days.map(e=>e.filter(e=>e.sets.some(e=>null!==e.rpe(1)&&null!==e.reps(1))).map(e=>e.movementId)).flat())],n=[...new Set(r.days.map(e=>e.filter(e=>e.sets.every(e=>null===e.rpe(1)||null===e.reps(1))).map(e=>e.movementId)).flat())],a=(L.initShareContainer(),k("button",["clearButton"],"âœ– Reset Progress"));if(a.onclick=()=>{var e=y(d)();g(),b(d)(e),W.render()},this.startDateOption=(e=>{const t=document.createElement("input");t.id=m.getUniqueId(),t.onchange=()=>{0<t.valueAsNumber?b(t.id)(t.valueAsNumber/1e5):localStorage.removeItem(t.id)},t.setAttribute("type","date");e=1e5*y(t.id)(e);return e&&(t.valueAsNumber=e),t})(),this.startDateOption.addEventListener("change",()=>{const n=0<this.startDateOption.valueAsNumber?new Date(this.startDateOption.value):null,a=(new Date).toJSON().substring(0,10);document.querySelectorAll(".dayLegend").forEach((e,t)=>{n instanceof Date?(e.textContent=n.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"}),n.toJSON().substring(0,10)==a&&e.parentElement.parentElement.scrollIntoView({behavior:"smooth"}),n.setDate(n.getDate()+1)):e.textContent=""})}),this.programSettingsContainer.append(k("label",[],["Start date:",this.startDateOption])),this.programSettingsContainer.append(...[{title:"Required e1RMs",movs:n},{title:"Optional e1RMs",movs:t}].map(e=>0<e.movs.length?k("table",["settingsTable"],[k("caption",[],e.title+":"),(e=>k("tr",[],e.map(e=>k("th",[],e))))(["Movment","e1RM"]),...e.movs.map(e=>{const t=S(75,1e3,2.5);return t.addEventListener("change",()=>{this.movementsMaxMap.set(e,t.value)}),this.movementsMaxInputMap.set(e,t),this.movementsMaxMap.set(e,t.value),ne([B(e),t])})]):null).filter(e=>null!==e),L.getShareButton(),L.shareContainer,a),e){this.programSettingsContainer.append(A.getProgramEditorButton());const c=k("div",[]),p=k("button",[],"ðŸŒShare program");p.onclick=()=>{x(c);const e=new URL(window.location.origin);e.searchParams.set("t",r.title),e.searchParams.set("p",s);var t=u().filter(e=>e.match(/^\d{4}$/g)).filter(e=>e!=d).map(e=>Y(e,localStorage.getItem(e))).join("-");0<t.length&&e.searchParams.set("r",t);const n=k("input",["presentedlink"],""),a=(n.type="text",n.value=e.href,k("button",[],"Copy"));a.onclick=()=>{n.select(),document.execCommand("copy")};t=k("div",["shareStringContainer"],[n,a]);c.append(t)},this.programSettingsContainer.append(p,c)}0!=n.length&&![...this.movementsMaxInputMap.keys()].filter(e=>n.includes(e)).every(e=>0<this.movementsMaxInputMap.get(e).value)||(this.programSettingsContainer.style.display="none");const l=k("button",[],"ðŸ  Go to homepage"),o=(l.onclick=()=>{h(),g(),localStorage.removeItem(d),location.reload()},k("button",[],"â¤“ Download spreadsheet")),i=(o.onclick=()=>{W.downLoadSpreadSheet()},k("button",["closebutton"],"â–² â–² â–²"));i.onclick=()=>this.toggleVisibility(!0),this.programSettingsContainer.append(l,o,i)}}class A{static programEditorContainer=document.getElementById("programEditorContainer");static toggleVisibility=()=>{var e;E(this.programEditorContainer,"flex"),"none"!=this.programEditorContainer.style.display&&(R.selectProgramContainer.classList.remove("visible"),e=document.getElementById("linkList"),x(e),W.scrollLeftButton.style.display="none",W.scrollRightButton.style.display="none"),window.scrollTo({top:0,behavior:"smooth"})};static getNewProgramButton=()=>{const e=k("button",["createNewProgramButton"],"Create new program");return e.onclick=()=>{R.selectProgramContainer.classList.remove("visible"),h(),g(),W.render({title:"New program",shareString:"ks00000000000000"},!1)},e};static getProgramEditorButton=()=>{const e=k("button",[],"ðŸ“Edit Program");return e.onclick=()=>{this.toggleVisibility(),M.programSettingsContainer.style.display="none"},e};static setMutationInput=(e,t,n)=>{n.value="text"===n.type?e[t]:Number(e[t]),n.addEventListener("change",()=>{e[t]=n.value})};static init(){}static render=n=>{x(this.programEditorContainer);const a=T(n.title,n.shareString),e=k("button",["closebutton"],"â–² â–² â–²"),t=(e.onclick=this.toggleVisibility,k("input",[])),r=(t.setAttribute("type","text"),A.setMutationInput(a,"title",t),t.value=a.title,k("input",[])),s=(r.setAttribute("type","number"),r.addEventListener("change",()=>c.dispatchEvent(new Event("render"))),A.setMutationInput(a,"numberOfIterations",r),k("input",[])),o=(s.setAttribute("type","number"),s.onchange=()=>{s.value<=a.days.length?a.days=a.days.slice(0,s.value):s.value<=10&&a.days.push(...Array(s.value-a.days.length).fill([])),c.dispatchEvent(new Event("render"))},s.value=a.days.length,this.programEditorContainer.append(e,k("div",["editorFieldBox"],[k("label",[],"Title"),t]),k("div",["editorFieldBox"],[k("label",[],"Number of iterations/weeks"),r]),k("div",["editorFieldBox"],[k("label",[],"Number of days per week/iteration"),s])),new Map([[N,{optionLabel:"None",nrOfParams:0}],[P,{optionLabel:"Linear",nrOfParams:2}],[O,{optionLabel:"Constant",nrOfParams:1}],[D,{optionLabel:"Steps",nrOfParams:a.numberOfIterations}]])),i=(e,t,n=!1)=>{const a=k("button",["editLegendButton"],"âœ–"),r=(a.onclick=n?()=>{e[t]=[],c.dispatchEvent(new Event("render"))}:()=>{e.splice(t,1),c.dispatchEvent(new Event("render"))},k("button",["editLegendButton"],"â–²")),s=(0<t&&1<e.length?r.onclick=()=>{e.splice(t-1,0,e.splice(t,1)[0]),c.dispatchEvent(new Event("render"))}:r.disabled=!0,k("button",["editLegendButton"],"â–¼"));if(e.length-1>t?s.onclick=()=>{e.splice(t+1,0,e.splice(t,1)[0]),c.dispatchEvent(new Event("render"))}:s.disabled=!0,n)return k("div",["editorLegendButtonList"],[r,s,a]);const l=k("button",["editLegendButton"],"â§‰");return l.onclick=()=>{e.splice(t,0,JSON.parse(JSON.stringify(e[t]))),c.dispatchEvent(new Event("render"))},k("div",["editorLegendButtonList"],[l,r,s,a])},c=k("div",["allDaysContainer"]),l=(c.addEventListener("render",e=>{x(c),c.append(...a.days.map((s,e)=>{const t=k("div",["dayEditContainer"]);var n=k("div",["innerDayEdit"],[((a,r)=>{const e=k("span",["copyDayList"],a.map((e,t)=>{const n=k("button",["copyDayButton","editorButton"],"Day "+(t+1));return n.onclick=()=>{a[r]=JSON.parse(JSON.stringify(e)),c.dispatchEvent(new Event("render"))},t==r&&(n.disabled=!0),n})),t=(e.style.display="none",k("button",["showCopyDayButton"],"Copy from a different day"));return t.onclick=()=>E(e),k("div",["fullWidth"],[t,e])})(a.days,e),...s.map((n,e)=>{const t=k("div",["movementEditContainer"]);var a=n.sets.map((l,e)=>{const t=k("div",["setContainer"]);return t.append(k("div",["editorLegend"],[k("span",["editorLegendTitle"],"Set "+(e+1)),i(n.sets,e)]),k("div",["innerSetEdit"],[...Object.entries(l).filter(([,e])=>e.type!=N).map(([e,a])=>{const t=k("div",["progressionContainer"]),r=k("select",["progressionSelect"]),n=k("div",["progressionEditor"]),s=(o.forEach((e,t)=>{const n=k("option",[],e.optionLabel);(n.value=t)===a.type&&(n.selected=!0),r.append(n)}),A.setMutationInput(a,"type",r),r.addEventListener("change",()=>{x(n);const e=new Map([[N,[]],[P,["initial","change"]],[O,["value"]],[D,Array(5).fill().map((e,t)=>"step "+(t+1))]]);n.append(((a,r)=>{const e=k("div",["paramsContainer"]),t=Array(r.length).fill();var n=t.map((e,t)=>{const n=k("input",["paramInput"]);return n.setAttribute("type","number"),n.min=-1e3,n.max=1e3,n.step=.25,A.setMutationInput(a,t,n),k("div",["paramBox"],[k("label",[],r[t]),n])});return e.append(...n),e})(a.params,e.get(Number(r.value))))}),r.dispatchEvent(new Event("change")),k("button",["clearButton","editorButton"],"âœ–"));return s.onclick=()=>{delete l[e],c.dispatchEvent(new Event("render"))},t.append(k("label",["progressionLabel"],ie[e]),r,n,s),t}),k("div",["setParamButtonList"],Object.keys(j).filter(e=>!Object.keys(l).includes(e)).map(e=>{{var t=l,n=e;const a=k("button",["addParamButton"],ie[n]);return a.onclick=()=>{t[n]={type:O,params:[]},c.dispatchEvent(new Event("render"))},a}}))])),t}),r=(a=>{a.movementId<=0&&(a.movementId="12");const r=k("input",[]);var e=B(a.movementId);return r.value=I(e),r.addEventListener("keyup",e=>{if(" "==e.key){const t=r.value.split(" "),n=t.filter(e=>1<e.length).map(e=>q(e,p));e=n.map(e=>p[e]).join(" ");r.value=I(e)+" ",a.movementId=se(n)}}),r.addEventListener("focusout",()=>{const e=r.value.split(" "),t=e.filter(e=>1<e.length).map(e=>q(e,p));var n=t.map(e=>p[e]).join(" ");r.value=I(n)+" ",a.movementId=se(t)}),r})(n);return t.append(k("div",["editorLegend"],[k("span",["editorLegendTitle"],"Movement "+(e+1)),i(s,e)]),k("div",["innerMovementEdit"],[r,...a,(e=>{const t=k("button",["addSetButton"],"Add set");return t.onclick=()=>{e.sets.push({}),c.dispatchEvent(new Event("render"))},t})(n)])),t}),re(s),(e=>{const t=k("button",["addMovementButton"],"Add movement");return t.onclick=()=>{e.push({movementId:0,sets:[{}]}),c.dispatchEvent(new Event("render"))},t})(s)]);return t.append(k("div",["editorLegend"],[k("span",["editorLegendTitle"],"Day "+(e+1)),i(a.days,e,!0)]),n),t}))}),c.dispatchEvent(new Event("render")),this.programEditorContainer.append(c),k("button",[],"Save and render program"));l.onclick=()=>{var e=ce(a),t=`program-${n.id}-`+a.title;localStorage.getItem(t)?localStorage.setItem(t,e):(t=Z(a.title,e),b(d)(t)),W.render({title:a.title,shareString:e})},this.programEditorContainer.append(l),this.programEditorContainer.style.display=a.days.every(e=>0==e.length)?"flex":"none"}}class R{static selectProgramContainer=document.getElementById("selectProgramContainer");static getProgramSelectRow=(n,e=!1)=>{const t=k("div",["programSelectRow"]),a=k("button",["selectProgramButton"],n.title),r=(a.onclick=()=>{h(),g(),b(d)(n.id);const t=new RegExp("progress-"+n.id,"g");var e=u().filter(e=>e.match(t)).sort((e,t)=>Date.parse(t.substring(t.length-10))-Date.parse(e.substring(e.length-10)))[0],e=localStorage.getItem(e);"string"==typeof e&&1<e.length&&c(e),W.render(v(n.id)),this.selectProgramContainer.classList.remove("visible")},k("button",["selectProgramButton"],"âœŽ")),s=(r.onclick=()=>{h(),g(),W.render(n,!1),A.toggleVisibility(),M.programSettingsContainer.style.display="none",this.selectProgramContainer.classList.remove("visible")},k("button",["selectProgramButton"],"â§‰")),l=(s.onclick=()=>{h(),g(),W.render({title:"Copy of "+n.title,shareString:n.shareString},!1),A.toggleVisibility(),M.programSettingsContainer.style.display="none",this.selectProgramContainer.classList.remove("visible")},k("button",["selectProgramButton"],"âœ–"));return l.onclick=()=>{localStorage.removeItem(`program-${n.id}-`+n.title),t.remove()},e?t.append(a,k("div",["buttonList"],[l,r,s])):t.append(a,k("div",["buttonList"],[s])),t};static init(){const t=document.getElementById("programSelectButton");t.addEventListener("click",()=>{this.selectProgramContainer.classList.toggle("visible")}),document.addEventListener("mouseup",e=>{this.selectProgramContainer.contains(e.target)||null!==t&&t.contains(e.target)||this.selectProgramContainer.classList.remove("visible")})}static render=()=>{x(this.selectProgramContainer),this.selectProgramContainer.append(...i.map(e=>this.getProgramSelectRow(e)),...r().map(e=>this.getProgramSelectRow(e,!0)),A.getNewProgramButton())}}const P=1,O=2,N=3,D=4,t={linear:(...t)=>e=>t[0]+t[1]*e,constant:(...t)=>e=>t[0],none:()=>e=>null,steps:(...t)=>e=>t[e%t.length]},n=e=>{if("function"==typeof e)return e;if(void 0===e)return t.none();if(null==e)return t.none();if("number"==typeof e)return t.constant(e);if("object"==typeof e){if(e.type===P)return t.linear(...e.params);if(e.type===O)return t.constant(...e.params);if(e.type===N)return t.none();if(e.type===D)return t.steps(...e.params)}return t.none()};const oe=e=>({numberOfIterations:e.numberOfIterations,title:e.title,days:e.days.map(e=>e.map(e=>({movementId:e.movementId,sets:e.sets.map(e=>({reps:n(e.reps),rpe:n(e.rpe),perc:n(e.perc),weight:n(e.weight),repeat:null==e.repeat||void 0===e.repeat?t.constant(1):n(e.repeat)}))})))}),j={reps:1,rpe:2,perc:3,weight:4,repeat:5},ie={reps:"Reps",rpe:"RPE",perc:"Percentage",weight:"Weight",repeat:"Repeat"},a=(e,t)=>"object"==typeof t&&t.type!=N?[e,1,t.type,t.params.length,t.params]:[],ce=e=>_([e.numberOfIterations,e.days.length,e.days.map(e=>[0,e.length,e.map(e=>[e.movementId,e.sets.length,e.sets.map(e=>[0,Object.values(e).filter(e=>e.type!=N).length,...a(j.reps,e.reps),...a(j.rpe,e.rpe),...a(j.perc,e.perc),...a(j.weight,e.weight),...a(j.repeat,e.repeat)])])])].flat(8).map(e=>F(e)).map(e=>1<e.length?"-"+e.length+e:e).join("")),pe=e=>e.split(/(?=-)/g).map(e=>"-"===e[0]?[e.slice(2,2+Number(e[1])),...e.slice(2+Number(e[1])).split("")]:e.split("")).flat(),T=(e,t)=>{t=V(t);const n=pe(t).map(e=>X(e));const a=e=>({type:e[0][0],params:e[0].slice(1).flat()});return{numberOfIterations:n[0],title:e,days:((e,t)=>{const n=[0,0,0,0,0,0,e],a=[];let r=!1,s=!0;return t.forEach(e=>{var t=n.findIndex(e=>0<e);s?(6==t?a.push([e]):5==t?a.at(-1).push([e]):4==t?a.at(-1).at(-1).push([e]):3==t?a.at(-1).at(-1).at(-1).push([e]):2==t?a.at(-1).at(-1).at(-1).at(-1).push([e,[]]):1==t?a.at(-1).at(-1).at(-1).at(-1).at(-1).push([e,[]]):0==t&&a.at(-1).at(-1).at(-1).at(-1).at(-1).at(-1).push([e,[]]),s=!1,r=!0):-1<t&&(r?(n[t-1]=e,r=!1,s=2<t):6==t?a.at(-1).push([e]):5==t?a.at(-1).at(-1).push(e):4==t?a.at(-1).at(-1).at(-1).push(e):3==t?a.at(-1).at(-1).at(-1).at(-1).push(e):2==t?a.at(-1).at(-1).at(-1).at(-1).at(-1).push(e):1==t?a.at(-1).at(-1).at(-1).at(-1).at(-1).at(-1).push(e):0==t&&a.at(-1).at(-1).at(-1).at(-1).at(-1).at(-1).at(-1).push(e),--n[t],n.slice(0,t+1).every(e=>0==e)&&(r=!0,s=!0))}),a})(n[1],n.slice(2)).filter(e=>"object"==typeof e&&0<e.length).map(e=>e.filter(e=>"object"==typeof e&&0<e.length).map(e=>({movementId:e[0],sets:e.slice(1).filter(e=>"object"==typeof e&&0<e.length).map(e=>{const t={};return e.slice(1).map(e=>{e[0]==j.reps?t.reps=a(e.slice(1)):e[0]==j.rpe?t.rpe=a(e.slice(1)):e[0]==j.perc?t.perc=a(e.slice(1)):e[0]==j.weight?t.weight=a(e.slice(1)):e[0]==j.repeat&&(t.repeat=a(e.slice(1)))}),t})})))}};class W{static programContainer=document.getElementById("programContainer");static scrollLeftButton=document.getElementById("scrollLeftButton");static scrollRightButton=document.getElementById("scrollRightButton");static init(){const n=e=>{e=e.getBoundingClientRect();return 0<=e.left&&e.right<=(window.innerWidth||document.documentElement.clientWidth)};this.scrollLeftButton.onclick=()=>{const e=[...document.getElementsByClassName("blockContainer")];var t=e.find(e=>n(e));void 0!==t&&null!==t.previousElementSibling&&this.programContainer.scrollBy({top:0,left:0-t.offsetWidth,behavior:"smooth"})},this.scrollRightButton.onclick=()=>{const e=[...document.getElementsByClassName("blockContainer")];var t=e.reverse().find(e=>n(e));void 0!==t&&null!==t.nextElementSibling&&this.programContainer.scrollBy({top:0,left:t.offsetWidth,behavior:"smooth"})},this.programContainer.addEventListener("scroll",()=>{var e=[...document.getElementsByClassName("blockContainer")],t=e[0],t=(W.scrollLeftButton.style.display=n(t)?"none":"block",e[e.length-1]);W.scrollRightButton.style.display=n(t)?"none":"block"})}static render(e,t=!0){m.resetId(),x(this.programContainer),window.scrollTo({top:0});let n=v(y(d)(0));"object"==typeof e&&(n=e);var r,e=T(n.title,n.shareString);A.render(n),R.render();const a=document.getElementById("programHeader");if(a.textContent=n.title,t){t=!i.some(e=>e.id===n.id);const s=oe(e),l=(M.render(s,t,n.shareString),[...Array(s.numberOfIterations).keys()]),o=(this.programContainer.append(...l.map(a=>{var e=k("h2",["weekHeader"],"Week "+(a+1));const t=k("div",["blockContainer","weekelement"],e);return t.id="cycle"+a,t.append(...s.days.map((e,t)=>{{var v=a;const n=k("fieldset",["dayContainer"],[k("div",["defaultDayLegend"],[k("span",["dayLegendElement","smallWeekText"],"Week "+(v+1)),k("h2",["dayLegendElement"],"Day "+(t+1)),k("span",["dayLegendElement","dayLegend"],"")])]);return n.id=`day${v}-`+t,n.append(...e.map((h,e)=>{const b=[],t=h.sets.map(e=>Array(e.repeat(v)).fill(e)).flat(),y=k("button",["editAllDay"],"âœŽ"),n=(y.addEventListener("click",()=>{y.classList.toggle("pressed")}),w("movementContainerTemplate"));return n.prepend(k("caption",["dayCaption"],[B(h.movementId),y])),n.append(...t.map((n,e)=>{const t=S(0,50,1,n.reps(v),"Reps for set "+(e+1));null!==n.reps(v)&&(t.disabled=!0,t.classList.add("preDisabled"),y.addEventListener("click",()=>{t.disabled=!t.disabled}));var a=C(null!==n.perc(v)?n.perc(v)+"%":null,"Percentage for set "+(e+1),!0);const r=null!==n.perc(v)?C(n.weight(v),"Weight for set "+(e+1)):S(75,1e3,2.5,n.weight(v),"Weight for set "+(e+1)),s=S(1,10,.25,n.rpe(v),"Actual RPE for set "+(e+1)),l=k("div",["overlay"]);var o=k("div",["actualRpeContainer"],[l,s]);s.classList.add("rpeInput"),null===n.rpe(v)&&(s.disabled=!0,s.classList.add("preDisabled"),l.style.display="none",y.addEventListener("click",()=>{s.disabled=!s.disabled,E(l)})),l.addEventListener("click",()=>E(d,""));const i=k("input",["rpeRange"]),c=(i.setAttribute("type","range"),i.min=5,i.max=10,i.step=.25,i.value=s.value,k("button",["resetRpeButton"],"Reset")),p=(c.onclick=()=>{s.value=n.rpe(v),s.dispatchEvent(new Event("change")),i.value=n.rpe(v),i.dispatchEvent(new Event("change"))},k("td",["rpeRangeCell"],[null!==n.rpe(v)?k("span",["goalSpan"],"Goal: "+n.rpe(v)):"",c,i])),d=k("tr",["rpeRangeRow"],p),m=(p.setAttribute("colspan","6"),d.style.display="none",te(d,l),i.addEventListener("input",()=>{s.value=i.value,s.dispatchEvent(new Event("change"))}),i.addEventListener("change",()=>{d.style.display="none"}),C("...","Estimated 1RM for set "+(e+1),!0));if(null!==n.perc(v)){const g=()=>{var e=M.movementsMaxMap.get(h.movementId)??0,e=b.reduce((e,t)=>Math.max(Number(e),Number(t.value)),e),t="function"==typeof n.perc?n.perc(v):Number(n.perc);r.value=f(t*e/100)};g(),b.map(e=>e.addEventListener("change",g)),M.movementsMaxInputMap.has(h.movementId)&&M.movementsMaxInputMap.get(h.movementId).addEventListener("change",g)}b.push(m);const u=()=>r.value&&t.value&&s.value?J(Number(r.value))(Number(t.value))(Number(s.value)):null;return m.value=f(u()),[t,r,s,i].map(e=>e.addEventListener("input",()=>{m.value=f(u()),m.dispatchEvent(new Event("change"))})),[ne([ae("Checkbox indicating done set for set "+(e+1)),t,r,a,o,m]),d]}).flat()),n}),re(e)),n}})),t})),W.scrollRightButton.style.display="block",document.getElementById("linkList"));x(o),o.append(...(r=s,[...Array(r.numberOfIterations).keys()].map(n=>{const e=w("weeklinkTemplate"),t=w("cyclelinkTemplate","Week "+(n+1)),a=k("div",["dayButtonList"]);return a.append(...[...Array(r.days.length).keys()].map(e=>{const t=k("button",["dayButton"],"Day "+(e+1));return t.onclick=()=>{document.querySelector(`#day${n}-`+e).scrollIntoView({behavior:"smooth"}),a.style.display="none"},t})),a.style.display="none",te(a),e.append(t,a),t.onclick=()=>{"flex"==a.style.display?a.style.display="none":a.style.display="flex"},e}))),M.startDateOption.dispatchEvent(new Event("change"))}}static downLoadSpreadSheet(e){var o;const t=(new DOMParser).parseFromString('<?xml version="1.0" encoding="UTF-8"?><office:document xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:presentation="urn:oasis:names:tc:opendocument:xmlns:presentation:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:config="urn:oasis:names:tc:opendocument:xmlns:config:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:grddl="http://www.w3.org/2003/g/data-view#" xmlns:tableooo="http://openoffice.org/2009/table" xmlns:drawooo="http://openoffice.org/2010/draw" xmlns:calcext="urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0" xmlns:loext="urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0" xmlns:formx="urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0" xmlns:css3t="http://www.w3.org/TR/css3-text/" office:version="1.2" office:mimetype="application/vnd.oasis.opendocument.spreadsheet"><office:automatic-styles><style:style style:name="weekTitleRow" style:family="table-row"><style:table-row-properties style:row-height="29.14pt" fo:break-before="auto" style:use-optimal-row-height="true"/></style:style><style:style style:name="movementTitleRow" style:family="table-row"><style:table-row-properties style:row-height="24.46pt" fo:break-before="auto" style:use-optimal-row-height="true"/></style:style><style:style style:name="ta1" style:family="table" style:master-page-name="Default"><style:table-properties table:display="true" style:writing-mode="lr-tb"/></style:style><style:style style:name="WeekTitleCell" style:family="table-cell" style:parent-style-name="Default"><style:table-cell-properties style:text-align-source="fix" style:repeat-content="false" style:vertical-align="middle"/><style:paragraph-properties fo:text-align="center" fo:margin-left="0pt"/><style:text-properties fo:font-size="24pt" style:font-size-asian="24pt" style:font-size-complex="24pt"/></style:style><style:style style:name="doubleWidthCell" style:family="table-cell" style:parent-style-name="Default"><style:table-cell-properties style:text-align-source="fix" style:repeat-content="false" style:vertical-align="middle"/><style:paragraph-properties fo:text-align="center" fo:margin-left="0pt"/></style:style><style:style style:name="movementTitleCell" style:family="table-cell" style:parent-style-name="Default"><style:table-cell-properties style:text-align-source="fix" style:repeat-content="false" style:vertical-align="middle"/><style:paragraph-properties fo:text-align="center" fo:margin-left="0pt"/><style:text-properties fo:font-size="20pt" style:font-size-asian="20pt" style:font-size-complex="20pt"/></style:style></office:automatic-styles><office:body><office:spreadsheet/></office:body></office:document>',"text/xml"),r=(o=t,(e,t={},n=[],a="")=>{const r=o.createElement(e);for(var[s,l]of Object.entries(t))r.setAttribute(s,l);return 0<n.length&&r.append(...n),0<a.length&&(r.textContent=a),r}),n=t.getElementsByTagName("office:spreadsheet");let a=v(y(d)(0));"object"==typeof e&&(a=e);e=T(a.title,a.shareString);const s=oe(e),l=[...Array(s.numberOfIterations).keys()];n[0].append(...l.map(a=>r("table:table",{"table:name":"Week "+(a+1),"table:style-name":"ta1"},[r("table:table-row",{"table:style-name":"weekTitleRow"},[r("table:table-cell",{"table:style-name":"WeekTitleCell","office:value-type":"string","calcext:value-type":"string","table:number-columns-spanned":"6","table:number-rows-spanned":"1"},[r("text:p",{},[],"Week "+(a+1))]),r("table:covered-table-cell",{"table:number-columns-repeated":"5"}),r("table:table-cell",{"table:number-columns-repeated":"1017"})]),...s.days.map((e,t)=>[r("table:table-row",{},[r("table:table-cell",{"table:style-name":"doubleWidthCell","office:value-type":"string","calcext:value-type":"string","table:number-columns-spanned":"2","table:number-rows-spanned":"1"},[r("text:p",{},[],"Week "+(a+1))]),r("table:covered-table-cell",{"table:style-name":"Default"}),r("table:table-cell",{"table:style-name":"doubleWidthCell","office:value-type":"string","calcext:value-type":"string","table:number-columns-spanned":"2","table:number-rows-spanned":"1"},[r("text:p",{},[],"Day "+(t+1))]),r("table:covered-table-cell"),r("table:table-cell",{"table:number-columns-repeated":"1019"})]),...e.map(n=>[r("table:table-row",{"table:style-name":"movementTitleRow"},[r("table:table-cell",{"table:style-name":"movementTitleCell","office:value-type":"string","calcext:value-type":"string","table:number-columns-spanned":"6","table:number-rows-spanned":"1"},[r("text:p",{},[],B(n.movementId))]),r("table:covered-table-cell",{"table:number-columns-repeated":"5"}),r("table:table-cell",{"table:number-columns-repeated":"1017"})]),r("table:table-row",{},[...["","Reps","Weight","%","RPE",""].map(e=>r("table:table-cell",{"office:value-type":"string","calcext:value-type":"string"},[r("text:p",{},[],e)]))]),...n.sets.map(e=>Array(e.repeat(a)).fill(e)).flat().map((e,t)=>r("table:table-row",{},[...["",e.reps(a),f(M.movementsMaxMap.get(n.movementId)*e.perc(a)/100),e.perc(a),e.rpe(a),""].map(e=>r("table:table-cell",{"office:value-type":"string","calcext:value-type":"string"},[r("text:p",{},[],""+(null!=e?e:""))]))])).flat(),r("table:table-row",{},[])]).flat()]).flat()])));e=(new XMLSerializer).serializeToString(t);const i=document.createElement("a");i.setAttribute("href",window.URL.createObjectURL(new Blob([e],{type:"application/vnd.oasis.opendocument.spreadsheet-flat-xml"}))),i.setAttribute("download","trainingprogram.fods"),document.body.appendChild(i),i.click()}}W.init(),A.init(),M.init(),R.init();const e=new URLSearchParams(window.location.search);if(e.has("s")){var de=Number(e.get("s"));window.history.replaceState({},document.title,"/"),h(),g(),b(d)(de),e.has("r")&&c(e.get("r")),W.render()}else if(e.has("t")&&e.has("p")){var de=e.get("t").substring(0,30),me=e.get("p"),ue=(window.history.replaceState({},document.title,"/"),h(),g(),Z(de,me));e.has("r")&&c(e.get("r")),b(d)(ue),W.render({title:de,shareString:me})}else if(void 0===y(d)()){document.getElementById("welcomeMessageContainer").style.display="flex",R.render();const ge=document.getElementById("welcomeProgramList");ge.append(...i.map(e=>R.getProgramSelectRow(e)),...r().map(e=>R.getProgramSelectRow(e,!0))),document.getElementById("welcomeProgramListButton").onclick=()=>{ge.classList.toggle("visible")},document.getElementById("welcomeCreateNewButton").onclick=()=>{W.render({title:"New program",shareString:"ks00000000000000"},!1)},M.programSettingsButton.disabled=!0}else W.render();